{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}JC{% endblock %}</title>

  <link rel="stylesheet" href="{% static 'noticias/css/detalhe.css' %}">
  <meta name="csrf-token" content="{{ csrf_token }}">
  {% block extra_head %}{% endblock %}
</head>
<body>
  <div class="topbar">UOL</div>

  <header class="header">
    <div class="container row">
      <button class="icon-btn" aria-label="Abrir menu"><span>‚ò∞</span></button>
      <img class="logo" src="{% static 'noticias/img/logo-jc-pe.svg' %}" alt="JC Pernambuco">
      <div style="flex:1"></div>
      <button class="icon-btn" aria-label="Buscar"><span>üîç</span></button>
    </div>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="container" style="padding:32px 0">
    <p class="caption" style="text-align:center">¬© JC Pernambuco</p>
  </footer>

  {# =================== MODAL DE BOAS-VINDAS =================== #}
  <div id="welcomeModal"
       class="modal{% if show_welcome %} is-open{% endif %}"
       aria-hidden="{% if show_welcome %}false{% else %}true{% endif %}">
    <div class="modal__backdrop" data-close-modal></div>

    <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="welcome-title">
      <button class="modal__close" id="welcomeClose" aria-label="Fechar">√ó</button>

      <div class="modal__avatar" aria-hidden="true">
        <!-- c√≠rculo preto com avatar -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="64" height="64">
          <path d="M20 21a8 8 0 0 0-16 0"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </div>

      <h2 id="welcome-title" class="modal__title">
        Ol√°, {{ user.get_full_name|default:user.username|default:"Leitor(a)" }}! Seja bem-vindo(a)!
      </h2>

      <p class="modal__subtitle">Deseja personalizar sua experi√™ncia JC?</p>

      <div class="modal__actions">
        <a id="welcomeLater" class="modal__btn" href="{% url 'noticias:index' %}">Agora n√£o</a>
        <a class="modal__btn modal__btn--primary" href="{% url 'caca_links:escolher_tema' %}">Sim! Vamos l√°.</a>
      </div>

      <div class="modal__back">
        <a href="{% url 'noticias:index' %}">‚Äπ Voltar</a>
      </div>
    </div>
  </div>
  {# =================== /MODAL =================== #}

  {% block extra_js %}
    <script src="{% static 'noticias/js/jc.js' %}"></script>
    <script>
      (function () {
        const modal   = document.getElementById('welcomeModal');
        if (!modal) return;

        const closeBtn = document.getElementById('welcomeClose');
        const laterBtn = document.getElementById('welcomeLater');
        const backdrop = modal.querySelector('[data-close-modal]');

        function openModal() {
          modal.classList.add('is-open');
          modal.setAttribute('aria-hidden', 'false');
        }
        function closeModal() {
          modal.classList.remove('is-open');
          modal.setAttribute('aria-hidden', 'true');
        }

        // Fechar por X / backdrop / tecla Esc
        closeBtn?.addEventListener('click', (e) => { e.preventDefault(); closeModal(); });
        backdrop?.addEventListener('click', closeModal);
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

        // ‚ÄúAgora n√£o‚Äù fecha imediatamente (antes de navegar)
        laterBtn?.addEventListener('click', () => { closeModal(); });

        // Exp√µe no escopo global caso queira abrir/fechar programaticamente
        window.JC = window.JC || {};
        window.JC.openWelcome  = openModal;
        window.JC.closeWelcome = closeModal;
      })();
    </script>
  {% endblock %}
</body>
</html>
