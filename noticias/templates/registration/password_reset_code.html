{% extends "base.html" %}
{% load static %}

{% block title %}Informe o código — JC{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'noticias/css/detalhe.css' %}">
{% endblock %}

{% block content %}
<div class="otp-page">

  <div class="otp-back">
    <a href="{% url 'password_reset' %}">‹ Voltar</a>
  </div>

  <div class="otp-wrap">
    <!-- Logo centralizada (use seu SVG) -->
    <img class="otp-logo" src="{% static 'noticias/img/logo-jc-pe.svg' %}" alt="JC Pernambuco">

    <h1 class="otp-title">Informe o código recebido no e-mail</h1>
    <p class="otp-sub">
      Enviamos um código de segurança para <strong>{{ email }}</strong>.<br>
      O envio pode levar alguns minutos.
    </p>

    <form method="post" id="code-form" autocomplete="off">
      {% csrf_token %}
      <input type="hidden" name="code" id="code-hidden" />

      <div class="otp-boxes">
        {% for _ in "123456" %}
          <input class="otp-inp" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1" />
        {% endfor %}
      </div>

      <button type="submit" class="otp-submit">Confirmar</button>
    </form>
  </div>

  <p class="otp-foot">© JC Pernambuco</p>
</div>

<script>
  // Auto-avança, aceita só dígitos e junta no hidden
  const inputs = Array.from(document.querySelectorAll('.otp-inp'));
  const hidden = document.getElementById('code-hidden');
  if (inputs.length) inputs[0].focus();

  const syncHidden = () => hidden.value = inputs.map(i => (i.value || '').replace(/\D/g,'')).join('');

  inputs.forEach((inp, idx) => {
    inp.addEventListener('input', () => {
      inp.value = (inp.value || '').replace(/\D/g,'').slice(0,1);
      if (inp.value && idx < inputs.length - 1) inputs[idx+1].focus();
      syncHidden();
    });
    inp.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && !inp.value && idx > 0) inputs[idx-1].focus();
    });
    inp.addEventListener('paste', (e) => {
      const t = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g,'').slice(0,6);
      if (!t) return;
      e.preventDefault();
      for (let i=0;i<Math.min(6,t.length);i++) inputs[i].value = t[i];
      syncHidden();
      inputs[Math.min(t.length-1, 5)].focus();
    });
  });

  document.getElementById('code-form').addEventListener('submit', (e) => {
    syncHidden();
    if (hidden.value.length !== 6){
      e.preventDefault();
      alert('Digite os 6 dígitos.');
    }
  });
</script>
{% endblock %}
